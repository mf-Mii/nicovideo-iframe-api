"use strict";var NV;!function(e){let t,i,o;e.Player=class{constructor(e,t){this.videoTimeCache={cachedVideoTime:0,cachedTime:0},this.volume=1,this.muted=!1,this.showComment=!0,this.playerId=t.playerId?t.playerId:1,this.events=t.events||{},this.createVideoIframe(e,t.videoId,t.width,t.height),window.addEventListener("message",this.onMessage.bind(this))}isExistElemId(e){return null!=document.getElementById(e)}createVideoIframe(e,t,i,o){var n;if(!this.isExistElemId(e))return void console.error("[NV-Iframe] 指定されたIDの要素が存在しません");const a=`https://embed.nicovideo.jp/watch/${t}?w=${i}px&h=${o}&jsapi=1&playerId=${this.playerId}`,d=document.createElement("iframe");d.src=a,d.id="nicovideoPlayer"+(this.playerId>1?this.playerId:""),d.width=`${i}px`,d.height=`${o}px`,d.frameBorder="0",d.allow="autoplay; encrypted-media; fullscreen; picture-in-picture",null===(n=document.getElementById(e))||void 0===n||n.appendChild(d),d.onload=()=>{var e,t;null===(t=(e=this.events).onReady)||void 0===t||t.call(e)}}onMessage(e){var t,i,o,n,a,d,s,r,l,u,v,h,c,m,I,p;if("https://embed.nicovideo.jp"===e.origin&&e.data.playerId===this.playerId.toString())if("loadComplete"==e.data.eventName){const o=e.data.data;this.videoInfo=o,null===(i=(t=this.events).onLoadComplete)||void 0===i||i.call(t,o)}else if("playerStatusChange"==e.data.eventName){const t=e.data.data;t.playerStatus=t.playerStatus,null===(n=(o=this.events).onPlayerStatusChange)||void 0===n||n.call(o,t)}else if("statusChange"==e.data.eventName){const t=e.data.data;t.playerStatus=t.playerStatus,t.seekStatus=t.seekStatus,null===(d=(a=this.events).onStatusChange)||void 0===d||d.call(a,t)}else if("playerMetadataChange"==e.data.eventName){const t=e.data.data;this.videoTimeCache={cachedVideoTime:t.currentTime,cachedTime:Date.now()},this.volume=t.volume,this.muted=t.muted,this.showComment=t.showComment,null===(r=(s=this.events).onPlayerMetadataChange)||void 0===r||r.call(s,t)}else if("seekStatusChange"==e.data.eventName){const t=e.data.data;t.seekStatus=t.seekStatus,null===(u=(l=this.events).onSeekStatusChange)||void 0===u||u.call(l,t)}else"enterProgrammaticFullScreen"==e.data.eventName?null===(h=(v=this.events).onEnterProgrammaticFullScreen)||void 0===h||h.call(v):"exitProgrammaticFullScreen"==e.data.eventName?null===(m=(c=this.events).onExitProgrammaticFullScreen)||void 0===m||m.call(c):(console.error("[NV-Iframe] 不明なイベントが発生しました"),null===(p=(I=this.events).onError)||void 0===p||p.call(I,e.data))}_postMessage(e,t){const i=document.getElementById("nicovideoPlayer"+(this.playerId>1?this.playerId.toString():""));if(!i)return void console.error("[NV-Iframe] プレイヤーが存在しません");let n={eventName:e,playerId:this.playerId.toString(),sourceConnectorType:o.WEBSITE};t&&(n=Object.assign(Object.assign({},n),{data:t})),i.contentWindow?i.contentWindow.postMessage(n,"https://embed.nicovideo.jp"):console.error("[NV-Iframe] iframe.contentWindowが存在しません")}seek(e){this._postMessage("seek",{time:e})}play(){this._postMessage("play")}pause(){this._postMessage("pause")}volumeChange(e){this._postMessage("volumeChange",{volume:e})}commentVisibilityChange(e){this._postMessage("commentVisibilityChange",{commentVisibility:e})}incrementViewCount(){this._postMessage("incrementViewCount")}getVideoInfo(){return this.videoInfo}getVideoTime(){const e=this.videoTimeCache.cachedVideoTime,t=this.videoTimeCache.cachedTime;return e+(Date.now()-t)}getVideoId(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.videoId}getPlayerId(){return this.playerId}getVideoTitle(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.title}getVideoDescription(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.description}getVideoThumbnailUrl(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.thumbnailUrl}getVideoLength(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.lengthInSeconds}getVideoPostedAt(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.postedAt}getVideoViewCount(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.viewCount}getVideoMylistCount(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.mylistCount}getVideoCommentCount(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.commentCount}getVideoWatchId(){var e;return null===(e=this.videoInfo)||void 0===e?void 0:e.videoInfo.watchId}getVideoUrl(){return`https://www.nicovideo.jp/watch/${this.getVideoWatchId()}`}getVolume(){return this.volume}isMuted(){return this.muted}isShowComment(){return this.showComment}getPlayer(){return document.getElementById("nicovideoPlayer"+(this.playerId>1?this.playerId.toString():""))}},function(e){e[e.LOADING=1]="LOADING",e[e.PLAYING=2]="PLAYING",e[e.PAUSE=3]="PAUSE",e[e.END=4]="END"}(t=e.PlayerStatus||(e.PlayerStatus={})),function(e){e[e.NOT_SEEK=0]="NOT_SEEK",e[e.SEEK_DRAGGING=1]="SEEK_DRAGGING",e[e.SEEKING=2]="SEEKING"}(i=e.SeekStatus||(e.SeekStatus={})),function(e){e[e.NICOVIDEO=0]="NICOVIDEO",e[e.WEBSITE=1]="WEBSITE"}(o=e.SourceConnectorType||(e.SourceConnectorType={}))}(NV||(NV={})),"function"==typeof onNicoVideoIframeAPIReady&&onNicoVideoIframeAPIReady();